name: Deploy K8s Manifests

on:
  push:
    branches: [main]
    paths:
      - 'k8s/**'
  workflow_dispatch:

env:
  CLUSTER_NAME: general-k8s

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install doctl
        uses: digitalocean/action-doctl@v2
        with:
          token: ${{ secrets.DIGITALOCEAN_ACCESS_TOKEN }}

      - name: Configure kubectl
        run: doctl kubernetes cluster kubeconfig save ${{ env.CLUSTER_NAME }}

      - name: Apply k8s manifests
        run: kubectl apply -k k8s/

      - name: Show deployment status
        run: kubectl get pods -n domowik
